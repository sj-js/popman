function t(){var t=this;return this.popMap={},this.darkList=[],this.focusDarkMap={},this.lastPopIndex=0,this.divCamSizeChecker,getEl().ready(function(){getEl().resize(function(){for(var e in t.popMap)t.isOn(e)&&t.adjustPossition(e)})}),this}t.prototype.detect=function(t){var e=this;return getEl().ready(function(){for(var t=document.querySelectorAll("[data-pop]"),o=0;o<t.length;o++){var i=t[o],s=i.getAttribute("data-pop");e.add(s,i)}}),this},t.prototype.add=function(t){var e=t.name,o=document.createElement("div");o.style.display="inline-block",o.style.background="white",o.style.width=t.width?t.width:"100%",o.style.height=t.height?t.height:"100%",o.style.overflow="hidden",getEl(o).hideDiv(),getEl(o).addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),getEl(document.body).add(o);var i=t.add;return"function"==typeof i?i(t):"object"==typeof i&&(getEl(o).add(i),i.style.display="block",i.style.width="100%",i.style.height="100%"),this.popMap[e]=t,this.popMap[e].popEl=o,this.popMap[e].darkEl=null,this.popMap[e].isPoped=!1,this},t.prototype.isOn=function(t){var e=this.popMap[t];return e&&e.isPoped},t.prototype.toggle=function(t){this.isOn(t)?this.close(t):this.pop(t)},t.prototype.pop=function(t,e){var o=this.popMap[t],i=o.popEl.children[0];i.popIndex=++this.lastPopIndex,i.setAttribute("data-pop-index",i.popIndex),o.isPoped||(o.pop&&o.pop(o),o.noDark?getEl(document.body).add(o.popEl):(o.darkEl=this.spreadDark(o),getEl(o.darkEl).add(o.popEl)),this.adjustPossition(t),o.isPoped=!0,e&&e())},t.prototype.close=function(t,e){var o=this.popMap[t];o.isPoped&&(o.close&&o.close(o),getEl(o.popEl.parentNode).del(o.popEl),o.noDark||this.closeDark(o.darkEl),o.isPoped=!1,e&&e())},t.prototype.focusOn=function(t){if(!this.focusDarkMap.up&&t){var e=t.getBoundingClientRect?t.getBoundingClientRect():this.getBodyOffset(t),o=t.ownerDocument,i=o.defaultView||o.parentWindow,s=this.getFrameOffset(i),r=e.left+s.left,p=e.top+s.top,n=t.offsetWidth,a=t.offsetHeight;if(0==n)return!1;var l=this.getDivCamSizeChecker().offsetWidth,d=this.getDivCamSizeChecker().offsetHeight;this.focusDarkMap={up:this.getDarkEl(0,0,l,p),down:this.getDarkEl(0,p+a,l,d),left:this.getDarkEl(0,p,r,p+a),right:this.getDarkEl(r+n,p,l,p+a),arrow:this.getArrow(r-30,p-9,">>>")};for(var f in this.focusDarkMap){var h=this.focusDarkMap[f];getEl(document.body).add(h),window.getComputedStyle(h).background,"arrow"!=f&&this.setBackgroundColor(h,"rgba(0,0,0,.7)")}return!0}},t.prototype.focusOff=function(){for(var t in this.focusDarkMap){var e=this.focusDarkMap[t];getEl(e.parentNode).del(e),delete this.focusDarkMap[t]}},t.prototype.getDivCamSizeChecker=function(){if(!this.divCamSizeChecker){var t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.left="-7777px",t.style.top="-7777px",document.body.appendChild(t),this.divCamSizeChecker=t}return this.divCamSizeChecker},t.prototype.spreadDark=function(t){var e=this,o=getData().findHighestZIndex(["div"])+1,i="rgba(0,0,0,.7)",s=document.createElement("div");this.darkList.push(s),t.easyclose&&getEl(s).addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),e.close(t.name)}),getEl(s).showDiv(),getEl(document.body).add(s),s.style.display="block",s.style.width="100%",s.style.height="100%",s.style.zIndex=o;try{s.style.background=i}catch(r){if(i.indexOf("rgba")!=-1){i=i.replace("rgba","rgb");var p=i.lastIndexOf(",");i=i.substring(0,p)+")"}s.style.background=i}return s},t.prototype.adjustPossition=function(t,e){function o(t,e){var o=(t+"").length,i=(parseFloat(t)+"").length;return i==o?result=t+e:result=t,result}var i=this.popMap[t],s=i.popEl,r=s.parentNode.offsetWidth,p=s.parentNode.offsetHeight;p=0==p?this.getDivCamSizeChecker().offsetHeight:p,s.style.position="absolute";var n=this.getSolvedPopExpMap(r,i.expx),a=this.getSolvedPopExpMap(p,i.expy);s.style.left=o(n.pos,"px"),s.style.top=o(a.pos,"px"),s.style.width=o(n.size,"px"),s.style.height=o(a.size,"px")},t.prototype.getSolvedPopExpMap=function(t,e){var o,i,s,r,p,n,a,l,d,f=this.getSize;if(e){var h=e.indexOf("("),c=e.indexOf(")");d=h!=-1&&c!=-1,d?(i=e.substring(0,h),r=e.substring(c+1,e.length),s=e.substring(h+1,c)):(i="*",s=e,r="*"),p=f(t,i),n=f(t,s),a=f(t,r),"*"==s&&(n=t-p-a),l="*"==i&&"*"!=r?t-n-a:"*"!=i&&"*"==r?0:"*"==i&&"*"==r?(t-n)/2:p,o={isPopExp:d,expStart:i,expEnd:r,expSize:s,pos:l,size:n}}else o={isPopExp:!1,expStart:i,expEnd:r,expSize:s,pos:t-t/2-t/4,size:t/2};return o},t.prototype.getSize=function(t,e){return"undefined"==typeof e?0:(e+"").indexOf("%")!=-1?t*(parseFloat(e)/100):(e+"").indexOf("*")!=-1?0:e},t.prototype.closeDark=function(t){for(var e=this.darkList,o=0;o<e.length;o++)e[o]==t&&(e.splice(o,1),getEl(t.parentNode).del(t))},t.prototype.getDarkEl=function(t,e,o,i){function s(t){return t>=0?t:0}var r=50,p=document.createElement("div"),n="px";return p.style.left=t+n,p.style.top=e+n,p.style.width=s(o-t)+n,p.style.height=s(i-e)+n,p.style.zIndex=r,p.style.display="block",p.style.position="absolute",p.style.transition="background-color .5s, transform .5s",this.setBackgroundColor(p,"rgba(255,255,255,0)"),p},t.prototype.getArrow=function(t,e,o){var i=51,s=document.createElement("div"),r="px";return s.style.left=t+r,s.style.top=e+r,s.style.width="30px",s.style.height="30px",s.style.zIndex=i,s.style.display="block",s.style.position="absolute",s.style.transition="background-color .5s, transform .5s",s.style.color="white",s.innerHTML=o,s},t.prototype.getBodyOffset=function(t){for(var e=0,o=0,i=t,s=t.parentNode;s;){var r=0,p=0;if(i!=document.body&&(r=i.scrollLeft,p=i.scrollTop),!s.style)break;if("absolute"==s.style.position)e+=i.offsetLeft-r,o+=i.offsetTop-p;else{if("fixed"==s.style.position||"fixed"==i.style.position){e+=i.offsetLeft+this.getBodyScrollX(),o+=i.offsetTop+this.getBodyScrollY();break}e+=i.offsetLeft-s.offsetLeft-r,o+=i.offsetTop-s.offsetTop-p}i=s,s=s.parentNode}var n={left:e,top:o,width:t.offsetWidth,height:t.offsetHeight};return n},t.prototype.getFrameOffset=function(t,e){if(e="undefined"==typeof e?{top:0,left:0}:e,t!==top){var o=t.frameElement.getBoundingClientRect();e.left+=o.left,e.top+=o.top,e=this.getFrameOffset(t.parent,e)}return e},t.prototype.setBackgroundColor=function(t,e){try{t.style.background=e}catch(o){if(e.indexOf("rgba")!=-1){e=e.replace("rgba","rgb");var i=e.lastIndexOf(",");e=e.substring(0,i)+")"}t.style.background=e}};