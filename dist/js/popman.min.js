function PopMan(t){var e=this;this.event=new SjEvent,this.popMap={},this.popElementIdMap={},this.darkElementList=[],this.popElementStackList=[],this.focusDarkMap={},this.lastPopIndex=0,this.divCamSizeChecker,this.previewer,this.meta={nowEscControlPop:null,nowEnterControlPop:null,nowClickControlPop:null},this.modeAnimation=!0,this.modeSleep=!1,this.globalSetup={modeTest:!1,modeResize:!0,modeDark:!0,testPopClass:null,testPopBorderWidth:"1px",testPopBorderColor:"#39ff3e",testPopBackground:"#c0ffc9",alertExp:null,alertExpx:"300",alertExpy:"200",alertContent:null,confirmExp:null,confirmExpx:"400",confirmExpy:"300",confirmContent:null,loadingExp:null,loadingExpx:"200",loadingExpy:"200",loadingContent:null},t&&this.setup(t),document.addEventListener("keydown",function(t){var n=t.keyCode?t.keyCode:t.which;if(27==n){var o=e.popElementStackList.length-1,i=e.popElementStackList[o],a=e.getPop(i);a&&a.closebyesc&&(e.meta.nowEscControlPop=a)}if(13==n){var o=e.popElementStackList.length-1,i=e.popElementStackList[o],a=e.getPop(i);a&&a.okbyenter&&(e.meta.nowEnterControlPop=a)}}),document.addEventListener("keyup",function(t){var n=t.keyCode?t.keyCode:t.which;if(27==n){var o=e.popElementStackList.length-1,i=e.popElementStackList[o],a=e.getPop(i);a&&a.closebyesc&&e.meta.nowEscControlPop===a&&(e.meta.nowEscControlPop=null,e.close(a.element))}if(13==n){var o=e.popElementStackList.length-1,i=e.popElementStackList[o],a=e.getPop(i);if(a&&a.okbyenter&&e.meta.nowEnterControlPop===a){e.meta.nowEnterControlPop=null;var r=e.ok(a.element);r&&e.close(a.element)}}}),this.globalSetup.modeResize&&window.addEventListener("resize",function(){e.resize()}),ready(function(){e.resize()})}function AnimationMan(){this.event=new SjEvent,this.status,this.statusAnimationRunning=!1,this.animationRate=-1,this.funcWhenCompleteFadeIn=null,this.funcWhenCompleteFadeOut=null,this.animationTime=1e3,this.delta=16}try{var crossman=require("crossman"),ready=crossman.ready,getEl=crossman.getEl,newEl=crossman.newEl,getData=crossman.getData,SjEvent=crossman.SjEvent}catch(e){}try{module.exports=exports=PopMan}catch(e){}PopMan.prototype.setup=function(t){for(var e in t)this.globalSetup[e]=t[e];return this},PopMan.prototype.detect=function(t){var e=this;return ready(function(){var n;n=document.querySelectorAll("[data-pop]");for(var o=0;o<n.length;o++)e.add(n[o]);n=document.querySelectorAll("[data-preview]");for(var o=0;o<n.length;o++)e.addPreview(n[o]);t&&t(e),e.hasEventListenerByEventName("afterdetect")&&e.execEventListenerByEventName("afterdetect")}),this},PopMan.prototype.afterDetect=function(t){return this.addEventListenerByEventName("afterdetect",t),this},PopMan.prototype.beforeFirstPop=function(t){return this.addEventListenerByEventName("beforefirstpop",t),this},PopMan.prototype.afterLastPop=function(t){return this.addEventListenerByEventName("afterlastpop",t),this},PopMan.prototype.resize=function(){var t=this;for(var e in t.popMap){var n=t.getPopByManId(e);t.isOn(n.element)&&t.adjustPosition(n.element)}},PopMan.prototype.addEventListener=function(t,e,n){return this.event.addEventListener(t,e,n),this},PopMan.prototype.addEventListenerByEventName=function(t,e){return this.event.addEventListenerByEventName(t,e),this},PopMan.prototype.hasEventListener=function(t,e,n){return this.event.hasEventListener(t,e,n)},PopMan.prototype.hasEventListenerByEventName=function(t,e){return this.event.hasEventListenerByEventName(t,e)},PopMan.prototype.hasEventListenerByEventFunc=function(t){return this.event.hasEventListenerByEventFunc(t)},PopMan.prototype.removeEventListener=function(t,e,n){return this.event.removeEventListener(t,e,n)},PopMan.prototype.removeEventListenerByEventName=function(t,e){return this.event.removeEventListenerByEventName(t,e)},PopMan.prototype.removeEventListenerByEventFunc=function(t){return this.event.removeEventListenerByEventFunc(t)},PopMan.prototype.execEventListener=function(t,e,n){return this.event.execEventListener(t,e,n)},PopMan.prototype.execEventListenerByEventName=function(t,e){return this.event.execEventListenerByEventName(t,e)},PopMan.prototype.add=function(t){return null!=t.getAttribute("data-pop")&&void 0!=t.getAttribute("data-pop")||t.setAttribute("data-pop",""),null!=t.getAttribute("data-closebyclickin")&&void 0!=t.getAttribute("data-closebyclickin")&&""==t.getAttribute("data-closebyclickin")&&t.setAttribute("data-closebyclickin","true"),null!=t.getAttribute("data-closebyclickout")&&void 0!=t.getAttribute("data-closebyclickout")&&""==t.getAttribute("data-closebyclickout")&&t.setAttribute("data-closebyclickout","true"),null!=t.getAttribute("data-closebyesc")&&void 0!=t.getAttribute("data-closebyesc")&&""==t.getAttribute("data-closebyesc")&&t.setAttribute("data-closebyesc","true"),null!=t.getAttribute("data-enterok")&&void 0!=t.getAttribute("data-enterok")&&""==t.getAttribute("data-enterok")&&t.setAttribute("data-enterok","true"),this.set(t,{element:t,exp:t.getAttribute("data-exp"),expx:t.getAttribute("data-expx"),expy:t.getAttribute("data-expy"),modeDark:getData(t.getAttribute("data-mode-dark")).parse(),okbyenter:getData(t.getAttribute("data-enterok")).parse(),closebyesc:getData(t.getAttribute("data-closebyesc")).parse(),closebyclickout:getData(t.getAttribute("data-closebyclickout")).parse(),closebyclickin:getData(t.getAttribute("data-closebyclickin")).parse(),add:t.getAttribute("data-add"),pop:t.getAttribute("data-pop"),afterpop:t.getAttribute("data-afterpop"),close:t.getAttribute("data-close"),afterclose:t.getAttribute("data-afterclose")}),t},PopMan.prototype["new"]=function(t){var e=newEl("div").attr("data-pop","true").returnElement();return this.set(e,t),e},PopMan.prototype.set=function(t,e){var n=this,o=this.popMap;if(t=getEl(t).returnElement(),e=e?e:{},t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var i,a=e.id?e.id:t.id;null!=a&&""!=a&&void 0!==a?(i=a,t.id=a,t.popmanId=a):(i=e.popmanId?e.popmanId:getEl(o).getNewSeqId("popmanId"),t.id=i,t.popmanId=i),e.id=i,e.popmanId=i,e.element=t,e.modeDark=null==e.modeDark?n.globalSetup.modeDark:e.modeDark,e.darkElement=null,e.isPoped=!1,void 0!=e.closebyclickin&&null!=e.closebyclickin||(e.closebyclickin=!1),void 0!=e.closebyclickout&&null!=e.closebyclickout||(e.closebyclickout=!0),void 0!=e.closebyesc&&null!=e.closebyesc||(e.closebyesc=!0),void 0!=e.okbyenter&&null!=e.okbyenter||(e.okbyenter=!0),e.popContainerElement=this.setView(e),this.setTestView(e,n.globalSetup),"number"==typeof e.exp&&(e.exp=""+e.exp),"number"==typeof e.expx&&(e.expx=""+e.expx),"number"==typeof e.expy&&(e.expy=""+e.expy),this.popMap[i]=e,this.popElementIdMap[t.id]=e,e.pop&&this.addEventListener(t,"pop",e.pop),e.afterpop&&this.addEventListener(t,"afterpop",e.afterpop),e.add&&(e.add instanceof Function?(this.addEventListener(t,"add",e.add),e.add(e)):"string"==typeof e.add&&(t.innerHTML=e.add)),e.ok&&this.addEventListener(t,"ok",e.ok),e.close&&this.addEventListener(t,"close",e.close),e.afterclose&&this.addEventListener(t,"afterclose",e.afterclose)},PopMan.prototype.setView=function(t){var e=this,n=newEl("div").style("display:inline-block; overflow:auto;").setStyle("width",t.width?t.width:"100%").setStyle("height",t.height?t.height:"100%").hideDiv().appendTo(document.body).addEventListener("mousewheel",function(t){var e=n.scrollWidth-n.clientWidth,o=n.scrollHeight-n.clientHeight,i=(t.deltaX?t.deltaX:t.wheelDeltaX)/5,a=(t.deltaY?t.deltaY:t.wheelDeltaY)/5;a<0?0>=n.scrollTop&&(t.preventDefault(),t.stopPropagation()):a>0&&o<=n.scrollTop&&(t.preventDefault(),t.stopPropagation()),i<0?0>=n.scrollLeft&&(t.preventDefault(),t.stopPropagation()):i>0&&e<=n.scrollLeft&&(t.preventDefault(),t.stopPropagation())}).returnElement();t.closebyclickin?getEl(n).addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),e.close(t.element)}):getEl(n).addEventListener("click",function(t){}).addEventListener("mousedown",function(t){});var o=t.element;return"function"==typeof o?o=o(t):"object"==typeof o&&(o=o),getEl(n).add(getEl(o).setStyle("display","block").setStyle("width","100%").setStyle("height","100%")),t.content&&getEl(o).html(t.content),n},PopMan.prototype.setTestView=function(t,e){var n=t.element;e.modeTest&&(e.testPopClass&&getEl(n).addClass(e.testPopClass),e.testPopBorderWidth&&(n.style.borderWidth=e.testPopBorderWidth),e.testPopBorderColor&&(n.style.borderColor=e.testPopBorderColor),e.testPopBackground&&(n.style.background=e.testPopBackground))},PopMan.prototype.removePop=function(t){var e=this.getPop(t);t=e.element,delete this.popMap[e.id],delete this.popElementIdMap[e.id],this.removeEventListener(t,"pop"),this.removeEventListener(t,"afterpop"),this.removeEventListener(t,"add"),this.removeEventListener(t,"close"),this.removeEventListener(t,"afterclose"),this.removeEventListener(t,"ok")},PopMan.prototype.getPop=function(t){if("string"==typeof t)return this.getPopById(t);if(t instanceof Element)return this.getPopByEl(t);var e=this.getPopsByCondition(t);return null!=e&&e.length>0?e[0]:void 0},PopMan.prototype.getPopById=function(t){return this.popElementIdMap[t]},PopMan.prototype.getPopByEl=function(t){var e=this.popMap;if(t&&t.popmanId){var n=t.popmanId,o=e[n];return o}},PopMan.prototype.getPopByManId=function(t){return this.popMap[t]},PopMan.prototype.getPops=function(){return this.popMap},PopMan.prototype.getPopsByCondition=function(t){var e=[],n=this.popMap;for(var o in n){var i=n[o],a=getEl(i).find(t);a&&e.push(a)}return e},PopMan.prototype.getPopsByDomAttributeCondition=function(t){var e=[],n=this.popMap;for(var o in n){var i=n[o],a=i.element,r=getEl(a).findDomAttribute(t);r&&e.push(r)}return e},PopMan.prototype.has=function(t){var e=this.getPop(t);return!!e},PopMan.prototype.isOn=function(t){var e=this.getPop(t);return e&&e.isPoped},PopMan.prototype.toggle=function(t){this.isOn(t)?this.close(t):this.pop(t)},PopMan.prototype.pop=function(t,e,n){if(this.modeSleep&&!n)return!1;var o=this.getPop(t),i=t=o.element;return i.popIndex=++this.lastPopIndex,i.setAttribute("data-pop-index",i.popIndex),o.isPoped||(this.hasEventListener(i,"pop")&&this.execEventListener(i,"pop",o),o.modeDark&&(o.darkElement=this.spreadDark(o),this.pushStack(i)),getEl(o.popContainerElement).appendTo(document.body),this.adjustPosition(i),o.isPoped=!0,this.hasEventListener(i,"afterpop")&&this.execEventListener(i,"afterpop",o)),e&&e(o),this.modeAnimation&&o.modeAnimation&&(o.animation=o.animation?o.animation:this.generateDefaultAnimation(o),o.animation.fadeIn(function(){})),o},PopMan.prototype.popIfOff=function(t,e,n){if(!this.isOn(t))return this.pop(t,e,n)},PopMan.prototype.popTemp=function(t){return this.pop(this.add(this["new"](t)))},PopMan.prototype.ok=function(t,e){var n=!1,o=this.getPop(t);return t=o.element,o.isPoped&&this.hasEventListener(t,"ok")&&(n=this.execEventListener(t,"ok",o)),n},PopMan.prototype.close=function(t,e){var n=this.getPop(t);if(n){var o=this;if(t=n.element,n.isPoped){if(n.animation&&!n.animation.checkStatusFadeOutComplete())return void n.animation.fadeOut(function(){o.close(t,e)});this.hasEventListener(t,"close")&&this.execEventListener(t,"close",n),getEl(n.popContainerElement.parentNode).del(n.popContainerElement),n.modeDark&&this.closeDark(n.darkElement),n.isPoped=!1,this.hasEventListener(t,"afterclose")&&this.execEventListener(t,"afterclose",n),this.removeStack(n.element),e&&e(n.element)}}},PopMan.prototype.sleep=function(){this.modeSleep=!0},PopMan.prototype.active=function(){this.modeSleep=!1},PopMan.prototype.generateDefaultAnimation=function(t){var e=(new AnimationMan).setTime(300).addEventListenerByEventName("fadeinstart",function(n){e.customData={borderColor:getEl(t.popContainerElement).getStyle("borderColor")}}).addEventListenerByEventName("fadeoutstart",function(n){getEl(t.popContainerElement).setStyle("borderColor",e.customData.borderColor)}).addEventListenerByEventName("fadeinout",function(e){getEl(t.popContainerElement).setStyle("opacity",.85*e)});return e},PopMan.prototype.generateDefaultPreviewAnimation=function(t){var e=(new AnimationMan).setTime(300).addEventListenerByEventName("fadeinstart",function(n){e.customData={borderColor:getEl(t).getStyle("borderColor")}}).addEventListenerByEventName("fadeoutstart",function(n){getEl(t).setStyle("borderColor",e.customData.borderColor)}).addEventListenerByEventName("fadeinout",function(e){getEl(t).setStyle("opacity",.85*e)});return e},PopMan.prototype.alert=function(t,e){var n=this,o=this["new"]({exp:n.globalSetup.alertExp,expx:n.globalSetup.alertExpx,expy:n.globalSetup.alertExpy,closebyclickout:!0,closebyesc:!0,pop:function(t){},add:function(o){var i=o.element;!t&&n.globalSetup.alertContent&&(t=n.globalSetup.alertContent),o.okbyenter=!0,n.addEventListener(o.element,"ok",function(t){return!(e&&!e(t))});var a=newEl("div").addClass("sj-popman-obj-context-alert").style("display:block; width:100%; height:100%; text-align:center;").returnElement(),r=newEl("div").addClass("sj-popman-obj-box-content").style("display:block; width:100%; text-align:center;").appendTo(a).returnElement();newEl("button").addClass("sj-popman-obj-btn-alert").style("display:inline-block;").appendTo(a).html("O").addEventListener("click",function(){e&&!e()||n.close(i)}).returnElement();getEl(i).html("").add(a),getEl(r).add(t)},afterpop:function(t){},close:function(t){},afterclose:function(t){n.removePop(t.element)}});return this.add(o),this.pop(o,null,!0),o},PopMan.prototype.confirm=function(t,e,n){var o=this,i=this["new"]({exp:o.globalSetup.confirmExp,expx:o.globalSetup.confirmExpx,expy:o.globalSetup.confirmExpy,closebyclickout:!0,closebyesc:!0,pop:function(t){},add:function(i){var a=i.element;!t&&o.globalSetup.confirmContent&&(t=o.globalSetup.confirmContent),i.okbyenter=!0,o.addEventListener(i.element,"ok",function(t){return!(e&&!e(t))});var r=newEl("div").addClass("sj-popman-obj-context-confirm").style("display:block; width:100%; height:100%; text-align:center;").returnElement(),s=newEl("div").addClass("sj-popman-obj-box-content").style("display:block; width:100%; text-align:center;").appendTo(r).returnElement();newEl("button").addClass("sj-popman-obj-btn-confirm").style("display:inline-block;").html("O").appendTo(r).addEventListener("click",function(){e&&!e()||o.close(a)}).returnElement(),newEl("button").addClass("sj-popman-obj-btn-cancel").style("display:inline-block;").html("X").appendTo(r).addEventListener("click",function(){n&&!n()||o.close(a)}).returnElement();getEl(a).html("").add(r),getEl(s).add(t)},afterpop:function(t){},close:function(t){},afterclose:function(t){o.removePop(t.element)}});return this.add(i),this.pop(i,null,!0),i},PopMan.prototype.loading=function(t,e){var n=this,o=this["new"]({exp:n.globalSetup.loadingExp,expx:n.globalSetup.loadingExpx,expy:n.globalSetup.loadingExpy,closebyclickout:!1,closebyesc:!1,pop:function(t){},add:function(e){var o=e.element;if(!t&&n.globalSetup.loadingContent&&(t=n.globalSetup.loadingContent),t){getEl(o.parentNode).removeClass("sj-popman-obj-context-pop").addClass("sj-popman-obj-context-loading");var i=newEl("div").addClass("sj-popman-obj-box-content").style("display:block; width:100%; height:100%; text-align:center").add(t).returnElement();getEl(o).html("").add(i)}},afterpop:function(t){},close:function(t){},afterclose:function(t){n.removePop(t.element)}});this.add(o),this.pop(o,null,!0);var i=new Promise(function(t,n){e(t,n)}).then(function(t){n.close(o)})["catch"](function(t){n.close(o)});return i},PopMan.prototype.addPreview=function(t){this.setPreview(t,{content:t.getAttribute("data-preview")})},PopMan.prototype.setPreview=function(t,e){var n=this;getEl(t).addClass("sj-boxman-obj-previewable").addEventListener("mouseout",function(t){n.stopPreviewer()}).addEventListener("mouseover",function(t){n.startPreviewer(t,12,2,e.content)}).addEventListener("mousemove",function(t){var o;if(void 0!=t.touches);else{for(t.preventDefault(),o=t.target;(!o.classList||!o.classList.contains("sj-boxman-obj-previewable"))&&(o=o.parentNode););if(!o)return}n.movePreviewer(t,12,2,e.content)})},PopMan.prototype.createPreviewer=function(){return void 0==this.previewer&&(this.previewer=newEl("div").html("test").addClass("sj-boxman-obj-previewer").setStyle("display","none").setStyle("position","absolute").appendTo(document.body).returnElement()),this.previewer},PopMan.prototype.startPreviewer=function(t,e,n,o,i){return this.previewer=this.createPreviewer(),getEl(this.previewer).setStyle("display","block").setStyle("zIndex",getData().findHighestZIndex(["div"])+1).setStyle("left","-5555px").setStyle("top","-5555px"),i&&getEl(this.previewer).addClass(i),this.movePreviewer(t,e,n,o),this.modeAnimation&&(this.previewerAnimation=this.previewerAnimation?this.previewerAnimation:this.generateDefaultPreviewAnimation(this.previewer),this.previewerAnimation.fadeIn(function(){})),this},PopMan.prototype.stopPreviewer=function(){var t=this;return this.previewerAnimation&&!this.previewerAnimation.checkStatusFadeOutComplete()?void this.previewerAnimation.fadeOut(function(){t.stopPreviewer()}):(getEl(this.previewer).setStyle("display","none").removeFromParent(),this)},PopMan.prototype.movePreviewer=function(t,e,n,o){var i=getEl().getBodyScrollX(),a=getEl().getBodyScrollY(),r=t.clientX+i+e,s=t.clientY+a+n,p=5,l=window.innerWidth+i,d=window.innerHeight+a,c=getEl(this.previewer).getBoundingClientRect();return l<r+c.width&&(r=l-c.width-p),d<s+c.height&&(s=d-c.height-p),getEl(this.previewer).setStyle("display","block").setStyle("left",r+"px").setStyle("top",s+"px").appendTo(document.body),null!==o&&void 0!==o&&getEl(this.previewer).html(o?o:""),this},PopMan.prototype.focusOn=function(t){if(!this.focusDarkMap.up&&t){var e=t.getBoundingClientRect?t.getBoundingClientRect():this.getBodyOffset(t),n=t.ownerDocument,o=n.defaultView||n.parentWindow,i=this.getFrameOffset(o),a=e.left+i.left,r=e.top+i.top,s=t.offsetWidth,p=t.offsetHeight;if(0==s)return!1;var l=this.getDivCamSizeChecker().offsetWidth,d=this.getDivCamSizeChecker().offsetHeight;this.focusDarkMap={up:this.getDarkElement(0,0,l,r),down:this.getDarkElement(0,r+p,l,d),left:this.getDarkElement(0,r,a,r+p),right:this.getDarkElement(a+s,r,l,r+p),arrow:this.getArrow(a-30,r-9,">>>")};for(var c in this.focusDarkMap){var u=this.focusDarkMap[c];getEl(document.body).add(u),window.getComputedStyle(u).background,"arrow"!=c&&this.setBackgroundColor(u,"rgba(0,0,0,.7)")}return!0}},PopMan.prototype.focusOff=function(){for(var t in this.focusDarkMap){var e=this.focusDarkMap[t];getEl(e.parentNode).del(e),delete this.focusDarkMap[t]}},PopMan.prototype.getDivCamSizeChecker=function(){return this.divCamSizeChecker||(this.divCamSizeChecker=newEl("div").style("width:100%; height:100%; position:absolute; left:-7777px; top:-7777px;").appendTo(document.body).returnElement()),this.divCamSizeChecker},PopMan.prototype.spreadDark=function(t){var e=this,n=newEl("div").addClass("sj-popman-obj-dark").returnElement();t.closebyclickout&&getEl(n).addEventListener("mousedown",function(o){o.target==n&&(o.preventDefault(),o.stopPropagation(),e.meta.nowClickControlPop=t)}).addEventListener("mouseup",function(o){e.meta.nowClickControlPop===t&&o.target==n&&(e.meta.nowClickControlPop=null,e.close(t.element))}),this.darkElementList.push(n);var o="rgba(0,0,0,.7)";try{n.style.background=o}catch(i){if(o.indexOf("rgba")!=-1){o=o.replace("rgba","rgb");var a=o.lastIndexOf(",");o=o.substring(0,a)+")"}n.style.background=o}return n},PopMan.prototype.adjustPosition=function(t,e){var n,o,i,a,r=this.getPop(t),s=r.darkElement,p=r.popContainerElement,l=r.target,d=l&&l!==window;if(d){var c=getEl(l).getBoundingPageRect();n=c.left,o=c.top,i=c.width,a=c.height,getEl(p).setStyle("position","absolute").addClass("sj-popman-obj-container"),s&&getEl(s).setStyle("position","absolute").setStyle("display","block").setStyle("zIndex",getData().findHighestZIndex(["div"])+1).setStyle("left",n+"px").setStyle("top",o+"px").setStyle("width",i+"px").setStyle("height",a+"px").appendTo(document.body)}else n=0,o=0,i=window.innerWidth,a=0==window.innerHeight?this.getDivCamSizeChecker().offsetHeight:window.innerHeight,getEl(p).setStyle("position","fixed").addClass("sj-popman-obj-container"),s&&getEl(s).setStyle("left","0px").setStyle("top","0px").setStyle("width","100%").setStyle("height","100%").setStyle("position","fixed").setStyle("display","block").setStyle("zIndex",getData().findHighestZIndex(["div"])+1).add(p).appendTo(document.body);getEl(p).hasSomeClass(["sj-popman-obj-context-alert","sj-popman-obj-context-confirm","sj-popman-obj-context-loading"])||getEl(p).addClass("sj-popman-obj-context-pop");var u,h,m,f;if(r.exp){var v=this.getSolved2DPopExpMap(r.exp,i,a);u=v.posX+n,h=v.posY+o,m=v.sizeX,f=v.sizeY}else{var E=this.getSolvedPopExpMap(r.expx,i),y=this.getSolvedPopExpMap(r.expy,a);u=E.pos+n,h=y.pos+o,m=E.size,f=y.size}getEl(p).setStyle("left",PopMan.nvlDan(u,"px")).setStyle("top",PopMan.nvlDan(h,"px")).setStyle("width",PopMan.nvlDan(m,"px")).setStyle("height",PopMan.nvlDan(f,"px"))},PopMan.nvlDan=function(t,e){var n,o=(t+"").length,i=(parseFloat(t)+"").length;return n=i==o?t+e:t},PopMan.prototype.getSolvedPopExpMap=function(t,e){var n,o,i,a,r,s,p,l,d;if(t){var c=t.indexOf("("),u=t.indexOf(")");d=c!=-1&&u!=-1,d?(o=t.substring(0,c),a=t.substring(u+1,t.length),i=t.substring(c+1,u)):(o="*",i=t,a="*"),r=this.getSize(e,o,function(t,e,n){return"*"==e&&(e=0),e}),p=this.getSize(e,a,function(t,e,n){return"*"==e&&(e=0),e}),s=this.getSize(e,i,function(t,n,o){return"*"==n&&(n=e-r-p),n}),l="*"==o&&"*"!=a?e-s-p:"*"!=o&&"*"==a?0:"*"==o&&"*"==a?(e-s)/2:r,n={isPopExp:d,expStart:o,expEnd:a,expSize:i,pos:l,size:s}}else n={isPopExp:!1,expStart:o,expEnd:a,expSize:i,pos:e-e/2-e/4,size:e/2};return n},PopMan.prototype.getSolved2DPopExpMap=function(t,e,n){var o,i,a=t.split("/");if(1==a.length){var r=a[0].trim();o=this.getSolvedPopExpMap(r,e),i=this.getSolvedPopExpMap(r,n)}else o=this.getSolvedPopExpMap(a[0].trim(),e),i=this.getSolvedPopExpMap(a[1].trim(),n);return{posX:o.pos,sizeX:o.size,posY:i.pos,sizeY:i.size}},PopMan.prototype.getSize=function(t,e,n){var o=e+"",i=null,a=e,r=null;return function(e){var n=e.match(/[><=]{1,2}/gi);if(n)if(1!=n.length||e.indexOf("%")==-1&&!e.indexOf("*")){if(2==n.length&&(e.indexOf("%")!=-1||e.indexOf("*"))){var o=e.indexOf(n[0]),s=e.indexOf(n[1],o+1),p=e.substring(0,o).trim(),l=e.substring(o+1,s).trim(),d=e.substring(s+1,e.length).trim();""!=p&&(p.indexOf("%")!=-1&&(p=t*(parseFloat(p)/100)),n[0].indexOf("<")!=-1?i=n[0].indexOf("=")!=-1?p:p+1:n[0].indexOf(">")!=-1&&(r=n[0].indexOf("=")!=-1?p:p-1)),a=l,""!=d&&(d.indexOf("%")!=-1&&(d=t*(parseFloat(d)/100)),n[1].indexOf("<")!=-1?r=n[1].indexOf("=")!=-1?d:d-1:n[1].indexOf(">")!=-1&&(i=n[1].indexOf("=")!=-1?d:d+1))}}else;}(o),"undefined"==typeof e&&(a=0),a.indexOf("%")!=-1&&(a=t*(parseFloat(a)/100)),n&&(a=n(i,a,r)),a=parseFloat(a),null!=i&&(a=Math.max(i,a)),null!=r&&(a=Math.min(r,a)),a},PopMan.prototype.closeDark=function(t){for(var e=this.darkElementList,n=0;n<e.length;n++)e[n]==t&&(e.splice(n,1),getEl(t.parentNode).del(t))},PopMan.prototype.pushStack=function(t){this.popElementStackList.push(t),1==this.popElementStackList.length&&this.execEventListenerByEventName("beforefirstpop")},PopMan.prototype.removeStack=function(t){for(var e=this.popElementStackList,n=e.length-1;n>-1;n--)e[n]==t&&e.splice(n,1);0==this.countStack()&&this.execEventListenerByEventName("afterlastpop")},PopMan.prototype.countStack=function(){return this.popElementStackList.length},PopMan.prototype.getDarkElement=function(t,e,n,o){function i(t){return t>=0?t:0}var a=50,r="px",s=newEl("div").style("display:block; position:fixed; transition:background-color .5s, transform .5s;").setStyle("zIndex",a).setStyle("left",t+r).setStyle("top",e+r).setStyle("width",i(n-t)+r).setStyle("height",i(o-e)+r).returnElement();return this.setBackgroundColor(s,"rgba(255,255,255,0)"),s},PopMan.prototype.getArrow=function(t,e,n){var o=51,i=document.createElement("div"),a="px";return i.style.left=t+a,i.style.top=e+a,i.style.width="30px",i.style.height="30px",i.style.zIndex=o,i.style.display="block",i.style.position="absolute",i.style.transition="background-color .5s, transform .5s",i.style.color="white",i.innerHTML=n,i},PopMan.prototype.getBodyOffset=function(t){for(var e=0,n=0,o=t,i=t.parentNode;i;){var a=0,r=0;if(o!=document.body&&(a=o.scrollLeft,r=o.scrollTop),!i.style)break;if("absolute"==i.style.position)e+=o.offsetLeft-a,n+=o.offsetTop-r;else{if("fixed"==i.style.position||"fixed"==o.style.position){e+=o.offsetLeft+this.getBodyScrollX(),n+=o.offsetTop+this.getBodyScrollY();break}e+=o.offsetLeft-i.offsetLeft-a,n+=o.offsetTop-i.offsetTop-r}o=i,i=i.parentNode}var s={left:e,top:n,width:t.offsetWidth,height:t.offsetHeight};return s},PopMan.prototype.getFrameOffset=function(t,e){if(e="undefined"==typeof e?{top:0,left:0}:e,t!==top){var n=t.frameElement.getBoundingClientRect();e.left+=n.left,e.top+=n.top,e=this.getFrameOffset(t.parent,e)}return e},PopMan.prototype.setBackgroundColor=function(t,e){try{t.style.background=e}catch(n){if(e.indexOf("rgba")!=-1){e=e.replace("rgba","rgb");var o=e.lastIndexOf(",");e=e.substring(0,o)+")"}t.style.background=e}},AnimationMan.STATUS_NONE=0,AnimationMan.STATUS_FADE_IN=1,AnimationMan.STATUS_FADE_OUT=2,AnimationMan.EVENT_FADEINSTART="fadeinstart",AnimationMan.EVENT_FADEOUTSTART="fadeoutstart",AnimationMan.EVENT_FADEIN="fadein",AnimationMan.EVENT_FADEOUT="fadeout",AnimationMan.EVENT_FADEINOUT="fadeinout",AnimationMan.EVENT_FADEINCOMPLETE="fadeincomplete",AnimationMan.EVENT_FADEOUTCOMPLETE="fadeoutcomplete",AnimationMan.prototype.addEventListener=function(t,e,n){return this.event.addEventListener(t,e,n),this},AnimationMan.prototype.addEventListenerByEventName=function(t,e){return this.event.addEventListenerByEventName(t,e),this},AnimationMan.prototype.hasEventListener=function(t,e,n){return this.event.hasEventListener(t,e,n)},AnimationMan.prototype.hasEventListenerByEventName=function(t,e){return this.event.hasEventListenerByEventName(t,e)},AnimationMan.prototype.hasEventListenerByEventFunc=function(t){return this.event.hasEventListenerByEventFunc(t)},AnimationMan.prototype.removeEventListener=function(t,e,n){return this.event.removeEventListener(t,e,n)},AnimationMan.prototype.removeEventListenerByEventName=function(t,e){return this.event.removeEventListenerByEventName(t,e)},AnimationMan.prototype.removeEventListenerByEventFunc=function(t){return this.event.removeEventListenerByEventFunc(t)},AnimationMan.prototype.execEventListener=function(t,e,n){return this.event.execEventListener(t,e,n)},AnimationMan.prototype.execEventListenerByEventName=function(t,e){return this.event.execEventListenerByEventName(t,e)},AnimationMan.prototype.setTime=function(t){return this.animationTime=t,this},AnimationMan.prototype.setDelta=function(t){return this.delta=t,this},AnimationMan.prototype.fadeIn=function(t){return this.status=AnimationMan.STATUS_FADE_IN,this.funcWhenCompleteFadeIn=t,this.animationRate==-1&&(this.animationRate=0),0==this.animationRate&&this.execEventListenerByEventName(AnimationMan.EVENT_FADEINSTART,this.animationRate),this.checkStatusComplete()?(this.funcWhenCompleteFadeIn&&this.funcWhenCompleteFadeIn(),void(this.funcWhenCompleteFadeIn=null)):void(this.statusAnimationRunning||this.run())},AnimationMan.prototype.fadeOut=function(t){return this.status=AnimationMan.STATUS_FADE_OUT,this.funcWhenCompleteFadeOut=t,this.animationRate==-1&&(this.animationRate=1),1==this.animationRate&&this.execEventListenerByEventName(AnimationMan.EVENT_FADEOUTSTART,this.animationRate),this.checkStatusComplete()?(this.funcWhenCompleteFadeOut&&this.funcWhenCompleteFadeOut(),void(this.funcWhenCompleteFadeOut=null)):void(this.statusAnimationRunning||this.run())},AnimationMan.prototype.fadeOutWhenNotComplete=function(t){return!this.checkStatusFadeOutComplete()&&(this.fadeOut(t),!0)},AnimationMan.prototype.run=function(){var t=this;this.statusAnimationRunning=!0;var e=this.delta/this.animationTime;this.status==AnimationMan.STATUS_FADE_IN?(this.animationRate=Math.min(1,this.animationRate+e),this.execEventListenerByEventName(AnimationMan.EVENT_FADEIN,this.animationRate)):this.status==AnimationMan.STATUS_FADE_OUT&&(this.animationRate=Math.max(0,this.animationRate-e),this.execEventListenerByEventName(AnimationMan.EVENT_FADEOUT,this.animationRate)),this.execEventListenerByEventName(AnimationMan.EVENT_FADEINOUT,this.animationRate),t.checkStatusComplete()?(this.statusAnimationRunning=!1,this.status==AnimationMan.STATUS_FADE_IN?(this.funcWhenCompleteFadeIn&&this.funcWhenCompleteFadeIn(),this.funcWhenCompleteFadeIn=null,this.execEventListenerByEventName(AnimationMan.EVENT_FADEINCOMPLETE,this.animationRate)):this.status==AnimationMan.STATUS_FADE_OUT&&(this.funcWhenCompleteFadeOut&&this.funcWhenCompleteFadeOut(),this.funcWhenCompleteFadeOut=null,this.execEventListenerByEventName(AnimationMan.EVENT_FADEOUTCOMPLETE,this.animationRate))):setTimeout(function(){t.run()},this.delta)},AnimationMan.prototype.checkStatusComplete=function(){if(this.status==AnimationMan.STATUS_FADE_IN){if(1==this.animationRate)return!0}else if(this.status==AnimationMan.STATUS_FADE_OUT&&0==this.animationRate)return!0;return!1},AnimationMan.prototype.checkStatusFadeOutComplete=function(){return this.status==AnimationMan.STATUS_FADE_OUT&&this.checkStatusComplete()};