function PopMan(){var t=this;return this.event=new SjEvent,this.popMap={},this.popElementIdMap={},this.darkElementList=[],this.popElementStackList=[],this.focusDarkMap={},this.lastPopIndex=0,this.divCamSizeChecker,getEl(document).addEventListener("keydown",function(e){var o=e.keyCode?e.keyCode:e.which;if(27==o){var n=t.popElementStackList.length-1,i=t.popElementStackList[n],r=t.getPop(i);r&&r.closebyesc&&t.close(r.element)}}),getEl().ready(function(){getEl().resize(function(){for(var e in t.popMap){var o=t.getPopByManId(e);t.isOn(o.element)&&t.adjustPossition(o.element)}})}),this}PopMan.prototype.detect=function(t){var e=this;return getEl().ready(function(){var o;o=document.querySelectorAll("[data-pop]");for(var n=0;n<o.length;n++)e.add(o[n]);t&&t(e),e.hasEventListenerByEventName("afterdetect")&&e.execEventListenerByEventName("afterdetect")}),this},PopMan.prototype.afterDetect=function(t){return this.addEventListenerByEventName("afterdetect",t),this},PopMan.prototype.addEventListener=function(t,e,o){return this.event.addEventListener(t,e,o)},PopMan.prototype.addEventListenerByEventName=function(t,e){return this.event.addEventListenerByEventName(t,e)},PopMan.prototype.hasEventListener=function(t,e,o){return this.event.hasEventListener(t,e,o)},PopMan.prototype.hasEventListenerByEventName=function(t,e){return this.event.hasEventListenerByEventName(t,e)},PopMan.prototype.hasEventListenerByEventFunc=function(t){return this.event.hasEventListenerByEventFunc(t)},PopMan.prototype.removeEventListener=function(t,e,o){return this.event.removeEventListener(t,e,o)},PopMan.prototype.removeEventListenerByEventName=function(t,e){return this.event.removeEventListenerByEventName(t,e)},PopMan.prototype.removeEventListenerByEventFunc=function(t){return this.event.removeEventListenerByEventFunc(t)},PopMan.prototype.execEventListener=function(t,e,o){return this.event.execEventListener(t,e,o)},PopMan.prototype.execEventListenerByEventName=function(t,e){return this.event.execEventListenerByEventName(t,e)},PopMan.prototype.add=function(t){null!=t.getAttribute("data-pop")&&void 0!=t.getAttribute("data-pop")||t.setAttribute("data-pop",""),null!=t.getAttribute("data-closebyclickin")&&void 0!=t.getAttribute("data-closebyclickin")&&""==t.getAttribute("data-closebyclickin")&&t.setAttribute("data-closebyclickin","true"),null!=t.getAttribute("data-closebyclickout")&&void 0!=t.getAttribute("data-closebyclickout")&&""==t.getAttribute("data-closebyclickout")&&t.setAttribute("data-closebyclickout","true"),null!=t.getAttribute("data-escclose")&&void 0!=t.getAttribute("data-escclose")&&""==t.getAttribute("data-escclose")&&t.setAttribute("data-escclose","true"),this.set(t,{element:t,expx:t.getAttribute("data-expx"),expy:t.getAttribute("data-expy"),closebyesc:getData(t.getAttribute("data-escclose")).parse(),closebyclickout:getData(t.getAttribute("data-closebyclickout")).parse(),closebyclickin:getData(t.getAttribute("data-closebyclickin")).parse(),pop:t.getAttribute("data-pop"),close:t.getAttribute("data-close")})},PopMan.prototype["new"]=function(t){var e=newEl("div",{"data-pop":"true"},"");return this.set(e,t),e},PopMan.prototype.set=function(t,e){var o=this.popMap;if(t=getEl(t).obj,e=e?e:{},t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var n=e.popmanId?e.popmanId:getEl(o).getNewSeqId("popmanId");t.popmanId=n,e.element=t,e.darkElement=null,e.isPoped=!1,void 0!=e.closebyclickin&&null!=e.closebyclickin||(e.closebyclickin=!1),void 0!=e.closebyclickout&&null!=e.closebyclickout||(e.closebyclickout=!0),void 0!=e.closebyesc&&null!=e.closebyesc||(e.closebyesc=!0),e.popContainerElement=this.setView(e),this.popMap[n]=e,this.popElementIdMap[t.id]=e},PopMan.prototype.setView=function(t){var e=this,o=document.createElement("div");o.style.display="inline-block",o.style.background="white",o.style.width=t.width?t.width:"100%",o.style.height=t.height?t.height:"100%",o.style.overflow="hidden",getEl(o).hideDiv(),t.closebyclickin?getEl(o).addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),e.close(t.element)}):getEl(o).addEventListener("click",function(t){t.stopPropagation()}),getEl(document.body).add(o);var n=t.element;return"function"==typeof n?getEl(o).add(n(t)):"object"==typeof n&&(getEl(o).add(n),n.style.display="block",n.style.width="100%",n.style.height="100%"),o},PopMan.prototype.getPop=function(t){if("string"==typeof t)return this.getPopById(t);if(t instanceof Element)return this.getPopByEl(t);var e=this.getPopsByCondition(t);return null!=e&&e.length>0?e[0]:void 0},PopMan.prototype.getPopById=function(t){return this.popElementIdMap[t]},PopMan.prototype.getPopByEl=function(t){var e=this.popMap;if(t&&t.popmanId){var o=t.popmanId,n=e[o];return n}},PopMan.prototype.getPopByManId=function(t){return this.popMap[t]},PopMan.prototype.getPops=function(){return this.popMap},PopMan.prototype.getPopsByCondition=function(t){var e=[],o=this.popMap;for(var n in o){var i=o[n],r=getEl(i).find(t);r&&e.push(r)}return e},PopMan.prototype.getPopsByDomAttributeCondition=function(t){var e=[],o=this.popMap;for(var n in o){var i=o[n],r=i.element,s=getEl(r).findDomAttribute(t);s&&e.push(s)}return e},PopMan.prototype.isOn=function(t){var e=this.getPop(t);return e&&e.isPoped},PopMan.prototype.toggle=function(t){this.isOn(t)?this.close(t):this.pop(t)},PopMan.prototype.pop=function(t,e){var o=this.getPop(t),n=o.element;n.popIndex=++this.lastPopIndex,n.setAttribute("data-pop-index",n.popIndex),o.isPoped||(this.hasEventListener(t,"pop")&&this.execEventListener(t,"pop"),o.noDark?getEl(document.body).add(o.popContainerElement):(o.darkElement=this.spreadDark(o),getEl(o.darkElement).add(o.popContainerElement),this.popElementStackList.push(n)),this.adjustPossition(t),o.isPoped=!0,e&&e(o.element))},PopMan.prototype.close=function(t,e){var o=this.getPop(t);o.isPoped&&(this.hasEventListener(t,"close")&&this.execEventListener(t,"close"),getEl(o.popContainerElement.parentNode).del(o.popContainerElement),o.noDark||this.closeDark(o.darkElement),o.isPoped=!1,this.removeStack(t),e&&e())},PopMan.prototype.focusOn=function(t){if(!this.focusDarkMap.up&&t){var e=t.getBoundingClientRect?t.getBoundingClientRect():this.getBodyOffset(t),o=t.ownerDocument,n=o.defaultView||o.parentWindow,i=this.getFrameOffset(n),r=e.left+i.left,s=e.top+i.top,p=t.offsetWidth,a=t.offsetHeight;if(0==p)return!1;var l=this.getDivCamSizeChecker().offsetWidth,c=this.getDivCamSizeChecker().offsetHeight;this.focusDarkMap={up:this.getDarkElement(0,0,l,s),down:this.getDarkElement(0,s+a,l,c),left:this.getDarkElement(0,s,r,s+a),right:this.getDarkElement(r+p,s,l,s+a),arrow:this.getArrow(r-30,s-9,">>>")};for(var d in this.focusDarkMap){var u=this.focusDarkMap[d];getEl(document.body).add(u),window.getComputedStyle(u).background,"arrow"!=d&&this.setBackgroundColor(u,"rgba(0,0,0,.7)")}return!0}},PopMan.prototype.focusOff=function(){for(var t in this.focusDarkMap){var e=this.focusDarkMap[t];getEl(e.parentNode).del(e),delete this.focusDarkMap[t]}},PopMan.prototype.getDivCamSizeChecker=function(){if(!this.divCamSizeChecker){var t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.left="-7777px",t.style.top="-7777px",document.body.appendChild(t),this.divCamSizeChecker=t}return this.divCamSizeChecker},PopMan.prototype.spreadDark=function(t){var e=this,o=getData().findHighestZIndex(["div"])+1,n="rgba(0,0,0,.7)",i=document.createElement("div");this.darkElementList.push(i),t.closebyclickout&&getEl(i).addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),e.close(t.element)}),getEl(i).showDiv(),getEl(document.body).add(i),i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.zIndex=o;try{i.style.background=n}catch(r){if(n.indexOf("rgba")!=-1){n=n.replace("rgba","rgb");var s=n.lastIndexOf(",");n=n.substring(0,s)+")"}i.style.background=n}return i},PopMan.prototype.adjustPossition=function(t,e){function o(t,e){var o=(t+"").length,n=(parseFloat(t)+"").length;return n==o?result=t+e:result=t,result}var n=this.getPop(t),i=n.popContainerElement,r=i.parentNode.offsetWidth,s=i.parentNode.offsetHeight;s=0==s?this.getDivCamSizeChecker().offsetHeight:s,i.style.position="absolute";var p=this.getSolvedPopExpMap(r,n.expx),a=this.getSolvedPopExpMap(s,n.expy);i.style.left=o(p.pos,"px"),i.style.top=o(a.pos,"px"),i.style.width=o(p.size,"px"),i.style.height=o(a.size,"px")},PopMan.prototype.getSolvedPopExpMap=function(t,e){var o,n,i,r,s,p,a,l,c,d=this.getSize;if(e){var u=e.indexOf("("),f=e.indexOf(")");c=u!=-1&&f!=-1,c?(n=e.substring(0,u),r=e.substring(f+1,e.length),i=e.substring(u+1,f)):(n="*",i=e,r="*"),s=d(t,n),p=d(t,i),a=d(t,r),"*"==i&&(p=t-s-a),l="*"==n&&"*"!=r?t-p-a:"*"!=n&&"*"==r?0:"*"==n&&"*"==r?(t-p)/2:s,o={isPopExp:c,expStart:n,expEnd:r,expSize:i,pos:l,size:p}}else o={isPopExp:!1,expStart:n,expEnd:r,expSize:i,pos:t-t/2-t/4,size:t/2};return o},PopMan.prototype.getSize=function(t,e){return"undefined"==typeof e?0:(e+"").indexOf("%")!=-1?t*(parseFloat(e)/100):(e+"").indexOf("*")!=-1?0:e},PopMan.prototype.closeDark=function(t){for(var e=this.darkElementList,o=0;o<e.length;o++)e[o]==t&&(e.splice(o,1),getEl(t.parentNode).del(t))},PopMan.prototype.removeStack=function(t){for(var e=this.popElementStackList,o=0;o<e.length;o++)e[o]==t&&e.splice(o,1)},PopMan.prototype.getDarkElement=function(t,e,o,n){function i(t){return t>=0?t:0}var r=50,s=document.createElement("div"),p="px";return s.style.left=t+p,s.style.top=e+p,s.style.width=i(o-t)+p,s.style.height=i(n-e)+p,s.style.zIndex=r,s.style.display="block",s.style.position="absolute",s.style.transition="background-color .5s, transform .5s",this.setBackgroundColor(s,"rgba(255,255,255,0)"),s},PopMan.prototype.getArrow=function(t,e,o){var n=51,i=document.createElement("div"),r="px";return i.style.left=t+r,i.style.top=e+r,i.style.width="30px",i.style.height="30px",i.style.zIndex=n,i.style.display="block",i.style.position="absolute",i.style.transition="background-color .5s, transform .5s",i.style.color="white",i.innerHTML=o,i},PopMan.prototype.getBodyOffset=function(t){for(var e=0,o=0,n=t,i=t.parentNode;i;){var r=0,s=0;if(n!=document.body&&(r=n.scrollLeft,s=n.scrollTop),!i.style)break;if("absolute"==i.style.position)e+=n.offsetLeft-r,o+=n.offsetTop-s;else{if("fixed"==i.style.position||"fixed"==n.style.position){e+=n.offsetLeft+this.getBodyScrollX(),o+=n.offsetTop+this.getBodyScrollY();break}e+=n.offsetLeft-i.offsetLeft-r,o+=n.offsetTop-i.offsetTop-s}n=i,i=i.parentNode}var p={left:e,top:o,width:t.offsetWidth,height:t.offsetHeight};return p},PopMan.prototype.getFrameOffset=function(t,e){if(e="undefined"==typeof e?{top:0,left:0}:e,t!==top){var o=t.frameElement.getBoundingClientRect();e.left+=o.left,e.top+=o.top,e=this.getFrameOffset(t.parent,e)}return e},PopMan.prototype.setBackgroundColor=function(t,e){try{t.style.background=e}catch(o){if(e.indexOf("rgba")!=-1){e=e.replace("rgba","rgb");var n=e.lastIndexOf(",");e=e.substring(0,n)+")"}t.style.background=e}};