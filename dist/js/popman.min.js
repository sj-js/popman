function PopMan(e){var t=this;return this.event=new SjEvent,this.popMap={},this.popElementIdMap={},this.darkElementList=[],this.popElementStackList=[],this.focusDarkMap={},this.lastPopIndex=0,this.divCamSizeChecker,this.globalSetup={modeTest:!1,testPopClass:null,testPopBorderWidth:"1px",testPopBorderColor:"#39ff3e",testPopBackground:"#c0ffc9",alertExpx:"300",alertExpy:"200",confirmExpx:"400",confirmExpy:"300",loadingExpx:"200",loadingExpy:"200"},e&&this.setup(e),document.addEventListener("keydown",function(e){var o=e.keyCode?e.keyCode:e.which;if(27==o){var n=t.popElementStackList.length-1,i=t.popElementStackList[n],r=t.getPop(i);r&&r.closebyesc&&t.close(r.element)}if(13==o){var n=t.popElementStackList.length-1,i=t.popElementStackList[n],r=t.getPop(i);if(r&&r.okbyenter){var s=t.ok(r.element);s&&t.close(r.element)}}}),document.addEventListener("DOMContentLoaded",function(){window.addEventListener("resize",function(){t.resize()})},!1),this}try{module.exports=exports=PopMan}catch(e){}PopMan.prototype.setup=function(e){for(var t in e)this.globalSetup[t]=e[t];return this},PopMan.prototype.detect=function(e){var t=this;return getEl().ready(function(){var o;o=document.querySelectorAll("[data-pop]");for(var n=0;n<o.length;n++)t.add(o[n]);e&&e(t),t.hasEventListenerByEventName("afterdetect")&&t.execEventListenerByEventName("afterdetect")}),this},PopMan.prototype.afterDetect=function(e){return this.addEventListenerByEventName("afterdetect",e),this},PopMan.prototype.beforeFirstPop=function(e){return this.addEventListenerByEventName("beforefirstpop",e),this},PopMan.prototype.afterLastPop=function(e){return this.addEventListenerByEventName("afterlastpop",e),this},PopMan.prototype.resize=function(){var e=this;for(var t in e.popMap){var o=e.getPopByManId(t);e.isOn(o.element)&&e.adjustPossition(o.element)}},PopMan.prototype.addEventListener=function(e,t,o){return this.event.addEventListener(e,t,o)},PopMan.prototype.addEventListenerByEventName=function(e,t){return this.event.addEventListenerByEventName(e,t)},PopMan.prototype.hasEventListener=function(e,t,o){return this.event.hasEventListener(e,t,o)},PopMan.prototype.hasEventListenerByEventName=function(e,t){return this.event.hasEventListenerByEventName(e,t)},PopMan.prototype.hasEventListenerByEventFunc=function(e){return this.event.hasEventListenerByEventFunc(e)},PopMan.prototype.removeEventListener=function(e,t,o){return this.event.removeEventListener(e,t,o)},PopMan.prototype.removeEventListenerByEventName=function(e,t){return this.event.removeEventListenerByEventName(e,t)},PopMan.prototype.removeEventListenerByEventFunc=function(e){return this.event.removeEventListenerByEventFunc(e)},PopMan.prototype.execEventListener=function(e,t,o){return this.event.execEventListener(e,t,o)},PopMan.prototype.execEventListenerByEventName=function(e,t){return this.event.execEventListenerByEventName(e,t)},PopMan.prototype.add=function(e){null!=e.getAttribute("data-pop")&&void 0!=e.getAttribute("data-pop")||e.setAttribute("data-pop",""),null!=e.getAttribute("data-closebyclickin")&&void 0!=e.getAttribute("data-closebyclickin")&&""==e.getAttribute("data-closebyclickin")&&e.setAttribute("data-closebyclickin","true"),null!=e.getAttribute("data-closebyclickout")&&void 0!=e.getAttribute("data-closebyclickout")&&""==e.getAttribute("data-closebyclickout")&&e.setAttribute("data-closebyclickout","true"),null!=e.getAttribute("data-escclose")&&void 0!=e.getAttribute("data-escclose")&&""==e.getAttribute("data-escclose")&&e.setAttribute("data-escclose","true"),null!=e.getAttribute("data-enterok")&&void 0!=e.getAttribute("data-enterok")&&""==e.getAttribute("data-enterok")&&e.setAttribute("data-enterok","true"),this.set(e,{element:e,expx:e.getAttribute("data-expx"),expy:e.getAttribute("data-expy"),okbyenter:getData(e.getAttribute("data-enterok")).parse(),closebyesc:getData(e.getAttribute("data-escclose")).parse(),closebyclickout:getData(e.getAttribute("data-closebyclickout")).parse(),closebyclickin:getData(e.getAttribute("data-closebyclickin")).parse(),add:e.getAttribute("data-add"),pop:e.getAttribute("data-pop"),afterpop:e.getAttribute("data-afterpop"),close:e.getAttribute("data-close"),afterclose:e.getAttribute("data-afterclose")})},PopMan.prototype["new"]=function(e){var t=newEl("div",{"data-pop":"true"},"");return this.set(t,e),t},PopMan.prototype.set=function(e,t){var o=this,n=this.popMap;if(e=getEl(e).obj,t=t?t:{},e.isAdaptedBox)return!1;e.isAdaptedBox=!0,getEl(e).clas.add("sj-obj-box");var i,r=t.id?t.id:e.id;null!=r&&""!=r&&void 0!==r?(i=r,e.id=r,e.popmanId=r):(i=t.popmanId?t.popmanId:getEl(n).getNewSeqId("popmanId"),e.id=i,e.popmanId=i),t.id=i,t.popmanId=i,t.element=e,t.darkElement=null,t.isPoped=!1,void 0!=t.closebyclickin&&null!=t.closebyclickin||(t.closebyclickin=!1),void 0!=t.closebyclickout&&null!=t.closebyclickout||(t.closebyclickout=!0),void 0!=t.closebyesc&&null!=t.closebyesc||(t.closebyesc=!0),void 0!=t.okbyenter&&null!=t.okbyenter||(t.okbyenter=!0),t.popContainerElement=this.setView(t),this.setTestView(t,o.globalSetup),"number"==typeof t.expx&&(t.expx=""+t.expx),"number"==typeof t.expy&&(t.expy=""+t.expy),this.popMap[i]=t,this.popElementIdMap[e.id]=t,t.pop&&this.addEventListener(e,"pop",t.pop),t.afterpop&&this.addEventListener(e,"afterpop",t.afterpop),t.add&&(t.add instanceof Function?(this.addEventListener(e,"add",t.add),t.add(t)):"string"==typeof t.add&&(e.innerHTML=t.add)),t.ok&&this.addEventListener(e,"ok",t.ok),t.close&&this.addEventListener(e,"close",t.close),t.afterclose&&this.addEventListener(e,"afterclose",t.afterclose)},PopMan.prototype.setView=function(e){var t=this,o=document.createElement("div");o.style.display="inline-block",o.style.width=e.width?e.width:"100%",o.style.height=e.height?e.height:"100%",o.style.overflow="auto",getEl(o).hideDiv(),e.closebyclickin?getEl(o).addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),t.close(e.element)}):getEl(o).addEventListener("click",function(e){e.stopPropagation()}),getEl(document.body).add(o);var n=e.element;return"function"==typeof n?getEl(o).add(n(e)):"object"==typeof n&&(getEl(o).add(n),n.style.display="block",n.style.width="100%",n.style.height="100%"),e.content&&(n.innerHTML=e.content),o},PopMan.prototype.setTestView=function(e,t){var o=e.element;t.modeTest&&(t.testPopClass&&getEl(o).addClass(t.testPopClass),t.testPopBorderWidth&&(o.style.borderWidth=t.testPopBorderWidth),t.testPopBorderColor&&(o.style.borderColor=t.testPopBorderColor),t.testPopBackground&&(o.style.background=t.testPopBackground))},PopMan.prototype.removePop=function(e){var t=e.element;delete this.popMap[e.id],this.removeEventListener(t,"pop"),this.removeEventListener(t,"afterpop"),this.removeEventListener(t,"add"),this.removeEventListener(t,"close"),this.removeEventListener(t,"afterclose")},PopMan.prototype.getPop=function(e){if("string"==typeof e)return this.getPopById(e);if(e instanceof Element)return this.getPopByEl(e);var t=this.getPopsByCondition(e);return null!=t&&t.length>0?t[0]:void 0},PopMan.prototype.getPopById=function(e){return this.popElementIdMap[e]},PopMan.prototype.getPopByEl=function(e){var t=this.popMap;if(e&&e.popmanId){var o=e.popmanId,n=t[o];return n}},PopMan.prototype.getPopByManId=function(e){return this.popMap[e]},PopMan.prototype.getPops=function(){return this.popMap},PopMan.prototype.getPopsByCondition=function(e){var t=[],o=this.popMap;for(var n in o){var i=o[n],r=getEl(i).find(e);r&&t.push(r)}return t},PopMan.prototype.getPopsByDomAttributeCondition=function(e){var t=[],o=this.popMap;for(var n in o){var i=o[n],r=i.element,s=getEl(r).findDomAttribute(e);s&&t.push(s)}return t},PopMan.prototype.isOn=function(e){var t=this.getPop(e);return t&&t.isPoped},PopMan.prototype.toggle=function(e){this.isOn(e)?this.close(e):this.pop(e)},PopMan.prototype.pop=function(e,t){var o=this.getPop(e);e=o.element;var n=o.element;n.popIndex=++this.lastPopIndex,n.setAttribute("data-pop-index",n.popIndex),o.isPoped||(this.hasEventListener(e,"pop")&&this.execEventListener(e,"pop",o),o.noDark?getEl(document.body).add(o.popContainerElement):(o.darkElement=this.spreadDark(o),getEl(o.darkElement).add(o.popContainerElement),this.pushStack(n)),this.adjustPossition(e),o.isPoped=!0,this.hasEventListener(e,"afterpop")&&this.execEventListener(e,"afterpop",o)),t&&t(o.element)},PopMan.prototype.ok=function(e,t){var o=!1,n=this.getPop(e);return e=n.element,n.isPoped&&this.hasEventListener(e,"ok")&&(o=this.execEventListener(e,"ok",n)),o},PopMan.prototype.close=function(e,t){var o=this.getPop(e);e=o.element,o.isPoped&&(this.hasEventListener(e,"close")&&this.execEventListener(e,"close",o),getEl(o.popContainerElement.parentNode).del(o.popContainerElement),o.noDark||this.closeDark(o.darkElement),o.isPoped=!1,this.hasEventListener(e,"afterclose")&&this.execEventListener(e,"afterclose",o),this.removeStack(o.element),t&&t(o.element))},PopMan.prototype.alert=function(e,t){var o=this,n=this["new"]({expx:o.globalSetup.alertExpx,expy:o.globalSetup.alertExpy,closebyclickout:!0,closebyesc:!0,pop:function(e){},add:function(n){var i=n.element;n.okbyenter=!0,o.addEventListener(n.element,"ok",function(e){return!(t&&!t(e))});var r=getEl(newEl("div")).addClass("sj-popman-obj-context-alert").returnElement();r.style.display="block",r.style.width="100%",r.style.height="100%",r.style.textAlign="center";var s=getEl(newEl("div")).addClass("sj-popman-obj-box-content").appendTo(r).returnElement();s.style.display="block",s.style.width="100%",s.style.textAlign="center";var p=getEl(newEl("button")).addClass("sj-popman-obj-btn-alert").appendTo(r).returnElement();p.style.display="inline-block",p.innerHTML="O",p.addEventListener("click",function(){t&&!t()||o.close(i)}),i.innerHTML="","object"==typeof e?s.appendChild(e):s.innerHTML=e,i.appendChild(r)},afterpop:function(e){},close:function(e){},afterclose:function(e){o.removePop(e)}});return this.add(n),this.pop(n),n},PopMan.prototype.confirm=function(e,t,o){var n=this,i=this["new"]({expx:n.globalSetup.confirmExpx,expy:n.globalSetup.confirmExpy,closebyclickout:!0,closebyesc:!0,pop:function(e){},add:function(i){var r=i.element;i.okbyenter=!0,n.addEventListener(i.element,"ok",function(e){return!(t&&!t(e))});var s=getEl(newEl("div")).addClass("sj-popman-obj-context-confirm").returnElement();s.style.display="block",s.style.width="100%",s.style.height="100%",s.style.textAlign="center";var p=getEl(newEl("div")).addClass("sj-popman-obj-box-content").appendTo(s).returnElement();p.style.display="block",p.style.width="100%",p.style.textAlign="center";var a=getEl(newEl("button")).addClass("sj-popman-obj-btn-confirm").appendTo(s).returnElement();a.style.display="inline-block",a.innerHTML="O",a.addEventListener("click",function(){t&&!t()||n.close(r)});var l=getEl(newEl("button")).addClass("sj-popman-obj-btn-cancel").appendTo(s).returnElement();l.style.display="inline-block",l.innerHTML="X",l.addEventListener("click",function(){o&&!o()||n.close(r)}),r.innerHTML="","object"==typeof e?p.appendChild(e):p.innerHTML=e,r.appendChild(s)},afterpop:function(e){},close:function(e){},afterclose:function(e){n.removePop(e)}});return this.add(i),this.pop(i),i},PopMan.prototype.loading=function(e,t){var o=this,n=this["new"]({expx:o.globalSetup.loadingExpx,expy:o.globalSetup.loadingExpy,closebyclickout:!1,closebyesc:!1,pop:function(e){},add:function(t){var o=t.element,n=getEl(newEl("div")).addClass("sj-popman-obj-context-alert").returnElement();n.style.display="block",n.style.width="100%",n.style.height="100%",n.style.textAlign="center";var i=getEl(newEl("div")).addClass("sj-popman-obj-box-content").appendTo(n).returnElement();i.style.display="block",i.style.width="100%",i.style.textAlign="center",o.innerHTML="","object"==typeof e?i.appendChild(e):i.innerHTML=e,o.appendChild(n)},afterpop:function(e){},close:function(e){},afterclose:function(e){o.removePop(e)}});this.add(n),this.pop(n);var i=new Promise(function(e,o){t(e,o)}).then(function(e){o.close(n)})["catch"](function(e){o.close(n)});return i},PopMan.prototype.focusOn=function(e){if(!this.focusDarkMap.up&&e){var t=e.getBoundingClientRect?e.getBoundingClientRect():this.getBodyOffset(e),o=e.ownerDocument,n=o.defaultView||o.parentWindow,i=this.getFrameOffset(n),r=t.left+i.left,s=t.top+i.top,p=e.offsetWidth,a=e.offsetHeight;if(0==p)return!1;var l=this.getDivCamSizeChecker().offsetWidth,d=this.getDivCamSizeChecker().offsetHeight;this.focusDarkMap={up:this.getDarkElement(0,0,l,s),down:this.getDarkElement(0,s+a,l,d),left:this.getDarkElement(0,s,r,s+a),right:this.getDarkElement(r+p,s,l,s+a),arrow:this.getArrow(r-30,s-9,">>>")};for(var c in this.focusDarkMap){var u=this.focusDarkMap[c];getEl(document.body).add(u),window.getComputedStyle(u).background,"arrow"!=c&&this.setBackgroundColor(u,"rgba(0,0,0,.7)")}return!0}},PopMan.prototype.focusOff=function(){for(var e in this.focusDarkMap){var t=this.focusDarkMap[e];getEl(t.parentNode).del(t),delete this.focusDarkMap[e]}},PopMan.prototype.getDivCamSizeChecker=function(){if(!this.divCamSizeChecker){var e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.left="-7777px",e.style.top="-7777px",document.body.appendChild(e),this.divCamSizeChecker=e}return this.divCamSizeChecker},PopMan.prototype.spreadDark=function(e){var t=this,o=getData().findHighestZIndex(["div"])+1,n="rgba(0,0,0,.7)",i=document.createElement("div");this.darkElementList.push(i),e.closebyclickout&&getEl(i).addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),t.close(e.element)}),getEl(i).showDiv(),getEl(document.body).add(i),getEl(i).clas.add("sj-popman-obj-dark"),i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.zIndex=o;try{i.style.background=n}catch(r){if(n.indexOf("rgba")!=-1){n=n.replace("rgba","rgb");var s=n.lastIndexOf(",");n=n.substring(0,s)+")"}i.style.background=n}return i},PopMan.prototype.adjustPossition=function(e,t){function o(e,t){var o=(e+"").length,n=(parseFloat(e)+"").length;return n==o?result=e+t:result=e,result}var n=this.getPop(e),i=n.popContainerElement,r=i.parentNode.offsetWidth,s=i.parentNode.offsetHeight;s=0==s?this.getDivCamSizeChecker().offsetHeight:s,i.style.position="absolute",getEl(i).clas.add("sj-popman-obj-container");var p=this.getSolvedPopExpMap(r,n.expx),a=this.getSolvedPopExpMap(s,n.expy);i.style.left=o(p.pos,"px"),i.style.top=o(a.pos,"px"),i.style.width=o(p.size,"px"),i.style.height=o(a.size,"px")},PopMan.prototype.getSolvedPopExpMap=function(e,t){var o,n,i,r,s,p,a,l,d,c=this.getSize;if(t){var u=t.indexOf("("),f=t.indexOf(")");d=u!=-1&&f!=-1,d?(n=t.substring(0,u),r=t.substring(f+1,t.length),i=t.substring(u+1,f)):(n="*",i=t,r="*"),s=c(e,n),p=c(e,i),a=c(e,r),"*"==i&&(p=e-s-a),l="*"==n&&"*"!=r?e-p-a:"*"!=n&&"*"==r?0:"*"==n&&"*"==r?(e-p)/2:s,o={isPopExp:d,expStart:n,expEnd:r,expSize:i,pos:l,size:p}}else o={isPopExp:!1,expStart:n,expEnd:r,expSize:i,pos:e-e/2-e/4,size:e/2};return o},PopMan.prototype.getSize=function(e,t){return"undefined"==typeof t?0:(t+"").indexOf("%")!=-1?e*(parseFloat(t)/100):(t+"").indexOf("*")!=-1?0:t},PopMan.prototype.closeDark=function(e){for(var t=this.darkElementList,o=0;o<t.length;o++)t[o]==e&&(t.splice(o,1),getEl(e.parentNode).del(e))},PopMan.prototype.pushStack=function(e){this.popElementStackList.push(e),1==this.popElementStackList.length&&this.execEventListenerByEventName("beforefirstpop")},PopMan.prototype.removeStack=function(e){for(var t=this.popElementStackList,o=t.length-1;o>-1;o--)t[o]==e&&t.splice(o,1);0==this.popElementStackList.length&&this.execEventListenerByEventName("afterlastpop")},PopMan.prototype.getDarkElement=function(e,t,o,n){function i(e){return e>=0?e:0}var r=50,s=document.createElement("div"),p="px";return s.style.left=e+p,s.style.top=t+p,s.style.width=i(o-e)+p,s.style.height=i(n-t)+p,s.style.zIndex=r,s.style.display="block",s.style.position="absolute",s.style.transition="background-color .5s, transform .5s",this.setBackgroundColor(s,"rgba(255,255,255,0)"),s},PopMan.prototype.getArrow=function(e,t,o){var n=51,i=document.createElement("div"),r="px";return i.style.left=e+r,i.style.top=t+r,i.style.width="30px",i.style.height="30px",i.style.zIndex=n,i.style.display="block",i.style.position="absolute",i.style.transition="background-color .5s, transform .5s",i.style.color="white",i.innerHTML=o,i},PopMan.prototype.getBodyOffset=function(e){for(var t=0,o=0,n=e,i=e.parentNode;i;){var r=0,s=0;if(n!=document.body&&(r=n.scrollLeft,s=n.scrollTop),!i.style)break;if("absolute"==i.style.position)t+=n.offsetLeft-r,o+=n.offsetTop-s;else{if("fixed"==i.style.position||"fixed"==n.style.position){t+=n.offsetLeft+this.getBodyScrollX(),o+=n.offsetTop+this.getBodyScrollY();break}t+=n.offsetLeft-i.offsetLeft-r,o+=n.offsetTop-i.offsetTop-s}n=i,i=i.parentNode}var p={left:t,top:o,width:e.offsetWidth,height:e.offsetHeight};return p},PopMan.prototype.getFrameOffset=function(e,t){if(t="undefined"==typeof t?{top:0,left:0}:t,e!==top){var o=e.frameElement.getBoundingClientRect();t.left+=o.left,t.top+=o.top,t=this.getFrameOffset(e.parent,t)}return t},PopMan.prototype.setBackgroundColor=function(e,t){try{e.style.background=t}catch(o){if(t.indexOf("rgba")!=-1){t=t.replace("rgba","rgb");var n=t.lastIndexOf(",");t=t.substring(0,n)+")"}e.style.background=t}};