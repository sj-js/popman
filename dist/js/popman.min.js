function PopMan(t){var e=this;return this.event=new SjEvent,this.popMap={},this.popElementIdMap={},this.darkElementList=[],this.popElementStackList=[],this.focusDarkMap={},this.lastPopIndex=0,this.divCamSizeChecker,this.meta={nowEscControlPop:null,nowEnterControlPop:null,nowClickControlPop:null},this.modeSleep=!1,this.globalSetup={modeTest:!1,testPopClass:null,testPopBorderWidth:"1px",testPopBorderColor:"#39ff3e",testPopBackground:"#c0ffc9",alertExp:null,alertExpx:"300",alertExpy:"200",alertContent:null,confirmExp:null,confirmExpx:"400",confirmExpy:"300",confirmContent:null,loadingExp:null,loadingExpx:"200",loadingExpy:"200",loadingContent:null},t&&this.setup(t),document.addEventListener("keydown",function(t){var o=t.keyCode?t.keyCode:t.which;if(27==o){var n=e.popElementStackList.length-1,i=e.popElementStackList[n],p=e.getPop(i);p&&p.closebyesc&&(e.meta.nowEscControlPop=p)}if(13==o){var n=e.popElementStackList.length-1,i=e.popElementStackList[n],p=e.getPop(i);p&&p.okbyenter&&(e.meta.nowEnterControlPop=p)}}),document.addEventListener("keyup",function(t){var o=t.keyCode?t.keyCode:t.which;if(27==o){var n=e.popElementStackList.length-1,i=e.popElementStackList[n],p=e.getPop(i);p&&p.closebyesc&&e.meta.nowEscControlPop===p&&(e.meta.nowEscControlPop=null,e.close(p.element))}if(13==o){var n=e.popElementStackList.length-1,i=e.popElementStackList[n],p=e.getPop(i);if(p&&p.okbyenter&&e.meta.nowEnterControlPop===p){e.meta.nowEnterControlPop=null;var s=e.ok(p.element);s&&e.close(p.element)}}}),window.addEventListener("resize",function(){e.resize()}),document.addEventListener("DOMContentLoaded",function(){e.resize()},!1),this}try{module.exports=exports=PopMan}catch(e){}PopMan.prototype.setup=function(t){for(var e in t)this.globalSetup[e]=t[e];return this},PopMan.prototype.detect=function(t){var e=this;return getEl().ready(function(){var o;o=document.querySelectorAll("[data-pop]");for(var n=0;n<o.length;n++)e.add(o[n]);t&&t(e),e.hasEventListenerByEventName("afterdetect")&&e.execEventListenerByEventName("afterdetect")}),this},PopMan.prototype.afterDetect=function(t){return this.addEventListenerByEventName("afterdetect",t),this},PopMan.prototype.beforeFirstPop=function(t){return this.addEventListenerByEventName("beforefirstpop",t),this},PopMan.prototype.afterLastPop=function(t){return this.addEventListenerByEventName("afterlastpop",t),this},PopMan.prototype.resize=function(){var t=this;for(var e in t.popMap){var o=t.getPopByManId(e);t.isOn(o.element)&&t.adjustPossition(o.element)}},PopMan.prototype.addEventListener=function(t,e,o){return this.event.addEventListener(t,e,o)},PopMan.prototype.addEventListenerByEventName=function(t,e){return this.event.addEventListenerByEventName(t,e)},PopMan.prototype.hasEventListener=function(t,e,o){return this.event.hasEventListener(t,e,o)},PopMan.prototype.hasEventListenerByEventName=function(t,e){return this.event.hasEventListenerByEventName(t,e)},PopMan.prototype.hasEventListenerByEventFunc=function(t){return this.event.hasEventListenerByEventFunc(t)},PopMan.prototype.removeEventListener=function(t,e,o){return this.event.removeEventListener(t,e,o)},PopMan.prototype.removeEventListenerByEventName=function(t,e){return this.event.removeEventListenerByEventName(t,e)},PopMan.prototype.removeEventListenerByEventFunc=function(t){return this.event.removeEventListenerByEventFunc(t)},PopMan.prototype.execEventListener=function(t,e,o){return this.event.execEventListener(t,e,o)},PopMan.prototype.execEventListenerByEventName=function(t,e){return this.event.execEventListenerByEventName(t,e)},PopMan.prototype.add=function(t){null!=t.getAttribute("data-pop")&&void 0!=t.getAttribute("data-pop")||t.setAttribute("data-pop",""),null!=t.getAttribute("data-closebyclickin")&&void 0!=t.getAttribute("data-closebyclickin")&&""==t.getAttribute("data-closebyclickin")&&t.setAttribute("data-closebyclickin","true"),null!=t.getAttribute("data-closebyclickout")&&void 0!=t.getAttribute("data-closebyclickout")&&""==t.getAttribute("data-closebyclickout")&&t.setAttribute("data-closebyclickout","true"),null!=t.getAttribute("data-closebyesc")&&void 0!=t.getAttribute("data-closebyesc")&&""==t.getAttribute("data-closebyesc")&&t.setAttribute("data-closebyesc","true"),null!=t.getAttribute("data-enterok")&&void 0!=t.getAttribute("data-enterok")&&""==t.getAttribute("data-enterok")&&t.setAttribute("data-enterok","true"),this.set(t,{element:t,expx:t.getAttribute("data-expx"),expy:t.getAttribute("data-expy"),okbyenter:getData(t.getAttribute("data-enterok")).parse(),closebyesc:getData(t.getAttribute("data-closebyesc")).parse(),closebyclickout:getData(t.getAttribute("data-closebyclickout")).parse(),closebyclickin:getData(t.getAttribute("data-closebyclickin")).parse(),add:t.getAttribute("data-add"),pop:t.getAttribute("data-pop"),afterpop:t.getAttribute("data-afterpop"),close:t.getAttribute("data-close"),afterclose:t.getAttribute("data-afterclose")})},PopMan.prototype["new"]=function(t){var e=newEl("div",{"data-pop":"true"},"");return this.set(e,t),e},PopMan.prototype.set=function(t,e){var o=this,n=this.popMap;if(t=getEl(t).obj,e=e?e:{},t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var i,p=e.id?e.id:t.id;null!=p&&""!=p&&void 0!==p?(i=p,t.id=p,t.popmanId=p):(i=e.popmanId?e.popmanId:getEl(n).getNewSeqId("popmanId"),t.id=i,t.popmanId=i),e.id=i,e.popmanId=i,e.element=t,e.darkElement=null,e.isPoped=!1,void 0!=e.closebyclickin&&null!=e.closebyclickin||(e.closebyclickin=!1),void 0!=e.closebyclickout&&null!=e.closebyclickout||(e.closebyclickout=!0),void 0!=e.closebyesc&&null!=e.closebyesc||(e.closebyesc=!0),void 0!=e.okbyenter&&null!=e.okbyenter||(e.okbyenter=!0),e.popContainerElement=this.setView(e),this.setTestView(e,o.globalSetup),"number"==typeof e.expx&&(e.expx=""+e.expx),"number"==typeof e.expy&&(e.expy=""+e.expy),this.popMap[i]=e,this.popElementIdMap[t.id]=e,e.pop&&this.addEventListener(t,"pop",e.pop),e.afterpop&&this.addEventListener(t,"afterpop",e.afterpop),e.add&&(e.add instanceof Function?(this.addEventListener(t,"add",e.add),e.add(e)):"string"==typeof e.add&&(t.innerHTML=e.add)),e.ok&&this.addEventListener(t,"ok",e.ok),e.close&&this.addEventListener(t,"close",e.close),e.afterclose&&this.addEventListener(t,"afterclose",e.afterclose)},PopMan.prototype.setView=function(t){var e=this,o=document.createElement("div");o.style.display="inline-block",o.style.width=t.width?t.width:"100%",o.style.height=t.height?t.height:"100%",o.style.overflow="auto",getEl(o).hideDiv(),t.closebyclickin?getEl(o).addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),e.close(t.element)}):(getEl(o).addEventListener("click",function(t){t.stopPropagation()}),getEl(o).addEventListener("mousedown",function(t){t.stopPropagation()})),getEl(document.body).add(o);var n=t.element;return"function"==typeof n?getEl(o).add(n(t)):"object"==typeof n&&(getEl(o).add(n),n.style.display="block",n.style.width="100%",n.style.height="100%"),t.content&&(n.innerHTML=t.content),o},PopMan.prototype.setTestView=function(t,e){var o=t.element;e.modeTest&&(e.testPopClass&&getEl(o).addClass(e.testPopClass),e.testPopBorderWidth&&(o.style.borderWidth=e.testPopBorderWidth),e.testPopBorderColor&&(o.style.borderColor=e.testPopBorderColor),e.testPopBackground&&(o.style.background=e.testPopBackground))},PopMan.prototype.removePop=function(t){var e=this.getPop(t);t=e.element,delete this.popMap[e.id],delete this.popElementIdMap[e.id],this.removeEventListener(t,"pop"),this.removeEventListener(t,"afterpop"),this.removeEventListener(t,"add"),this.removeEventListener(t,"close"),this.removeEventListener(t,"afterclose")},PopMan.prototype.getPop=function(t){if("string"==typeof t)return this.getPopById(t);if(t instanceof Element)return this.getPopByEl(t);var e=this.getPopsByCondition(t);return null!=e&&e.length>0?e[0]:void 0},PopMan.prototype.getPopById=function(t){return this.popElementIdMap[t]},PopMan.prototype.getPopByEl=function(t){var e=this.popMap;if(t&&t.popmanId){var o=t.popmanId,n=e[o];return n}},PopMan.prototype.getPopByManId=function(t){return this.popMap[t]},PopMan.prototype.getPops=function(){return this.popMap},PopMan.prototype.getPopsByCondition=function(t){var e=[],o=this.popMap;for(var n in o){var i=o[n],p=getEl(i).find(t);p&&e.push(p)}return e},PopMan.prototype.getPopsByDomAttributeCondition=function(t){var e=[],o=this.popMap;for(var n in o){var i=o[n],p=i.element,s=getEl(p).findDomAttribute(t);s&&e.push(s)}return e},PopMan.prototype.has=function(t){var e=this.getPop(t);return!!e},PopMan.prototype.isOn=function(t){var e=this.getPop(t);return e&&e.isPoped},PopMan.prototype.toggle=function(t){this.isOn(t)?this.close(t):this.pop(t)},PopMan.prototype.pop=function(t,e,o){if(this.modeSleep&&!o)return!1;var n=this.getPop(t);t=n.element;var i=n.element;i.popIndex=++this.lastPopIndex,i.setAttribute("data-pop-index",i.popIndex),n.isPoped||(this.hasEventListener(t,"pop")&&this.execEventListener(t,"pop",n),n.noDark?getEl(document.body).add(n.popContainerElement):(n.darkElement=this.spreadDark(n),getEl(n.darkElement).add(n.popContainerElement),this.pushStack(i)),this.adjustPossition(t),n.isPoped=!0,this.hasEventListener(t,"afterpop")&&this.execEventListener(t,"afterpop",n)),e&&e(n.element)},PopMan.prototype.ok=function(t,e){var o=!1,n=this.getPop(t);return t=n.element,n.isPoped&&this.hasEventListener(t,"ok")&&(o=this.execEventListener(t,"ok",n)),o},PopMan.prototype.close=function(t,e){var o=this.getPop(t);t=o.element,o.isPoped&&(this.hasEventListener(t,"close")&&this.execEventListener(t,"close",o),getEl(o.popContainerElement.parentNode).del(o.popContainerElement),o.noDark||this.closeDark(o.darkElement),o.isPoped=!1,this.hasEventListener(t,"afterclose")&&this.execEventListener(t,"afterclose",o),this.removeStack(o.element),e&&e(o.element))},PopMan.prototype.sleep=function(){this.modeSleep=!0},PopMan.prototype.active=function(){this.modeSleep=!1},PopMan.prototype.alert=function(t,e){var o=this,n=this["new"]({exp:o.globalSetup.alertExp,expx:o.globalSetup.alertExpx,expy:o.globalSetup.alertExpy,closebyclickout:!0,closebyesc:!0,pop:function(t){},add:function(n){var i=n.element;!t&&o.globalSetup.alertContent&&(t=o.globalSetup.alertContent),n.okbyenter=!0,o.addEventListener(n.element,"ok",function(t){return!(e&&!e(t))});var p=getEl(newEl("div")).addClass("sj-popman-obj-context-alert").returnElement();p.style.display="block",p.style.width="100%",p.style.height="100%",p.style.textAlign="center";var s=getEl(newEl("div")).addClass("sj-popman-obj-box-content").appendTo(p).returnElement();s.style.display="block",s.style.width="100%",s.style.textAlign="center";var r=getEl(newEl("button")).addClass("sj-popman-obj-btn-alert").appendTo(p).returnElement();r.style.display="inline-block",r.innerHTML="O",r.addEventListener("click",function(){e&&!e()||o.close(i)}),i.innerHTML="","object"==typeof t?s.appendChild(t):s.innerHTML=t,i.appendChild(p)},afterpop:function(t){},close:function(t){},afterclose:function(t){o.removePop(t.element)}});return this.add(n),this.pop(n,null,!0),n},PopMan.prototype.confirm=function(t,e,o){var n=this,i=this["new"]({exp:n.globalSetup.confirmExp,expx:n.globalSetup.confirmExpx,expy:n.globalSetup.confirmExpy,closebyclickout:!0,closebyesc:!0,pop:function(t){},add:function(i){var p=i.element;!t&&n.globalSetup.confirmContent&&(t=n.globalSetup.confirmContent),i.okbyenter=!0,n.addEventListener(i.element,"ok",function(t){return!(e&&!e(t))});var s=getEl(newEl("div")).addClass("sj-popman-obj-context-confirm").returnElement();s.style.display="block",s.style.width="100%",s.style.height="100%",s.style.textAlign="center";var r=getEl(newEl("div")).addClass("sj-popman-obj-box-content").appendTo(s).returnElement();r.style.display="block",r.style.width="100%",r.style.textAlign="center";var a=getEl(newEl("button")).addClass("sj-popman-obj-btn-confirm").appendTo(s).returnElement();a.style.display="inline-block",a.innerHTML="O",a.addEventListener("click",function(){e&&!e()||n.close(p)});var l=getEl(newEl("button")).addClass("sj-popman-obj-btn-cancel").appendTo(s).returnElement();l.style.display="inline-block",l.innerHTML="X",l.addEventListener("click",function(){o&&!o()||n.close(p)}),p.innerHTML="","object"==typeof t?r.appendChild(t):r.innerHTML=t,p.appendChild(s)},afterpop:function(t){},close:function(t){},afterclose:function(t){n.removePop(t.element)}});return this.add(i),this.pop(i,null,!0),i},PopMan.prototype.loading=function(t,e){var o=this,n=this["new"]({exp:o.globalSetup.loadingExp,expx:o.globalSetup.loadingExpx,expy:o.globalSetup.loadingExpy,closebyclickout:!1,closebyesc:!1,pop:function(t){},add:function(e){var n=e.element;if(!t&&o.globalSetup.loadingContent&&(t=o.globalSetup.loadingContent),t){getEl(n.parentNode).removeClass("sj-popman-obj-context-pop").addClass("sj-popman-obj-context-loading");var i=getEl(newEl("div")).addClass("sj-popman-obj-box-content").style("display:block; width:100%; height:100%; text-align:center").add(t).returnElement();getEl(n).html("").add(i)}},afterpop:function(t){},close:function(t){},afterclose:function(t){o.removePop(t.element)}});this.add(n),this.pop(n,null,!0);var i=new Promise(function(t,o){e(t,o)}).then(function(t){o.close(n)})["catch"](function(t){o.close(n)});return i},PopMan.prototype.focusOn=function(t){if(!this.focusDarkMap.up&&t){var e=t.getBoundingClientRect?t.getBoundingClientRect():this.getBodyOffset(t),o=t.ownerDocument,n=o.defaultView||o.parentWindow,i=this.getFrameOffset(n),p=e.left+i.left,s=e.top+i.top,r=t.offsetWidth,a=t.offsetHeight;if(0==r)return!1;var l=this.getDivCamSizeChecker().offsetWidth,d=this.getDivCamSizeChecker().offsetHeight;this.focusDarkMap={up:this.getDarkElement(0,0,l,s),down:this.getDarkElement(0,s+a,l,d),left:this.getDarkElement(0,s,p,s+a),right:this.getDarkElement(p+r,s,l,s+a),arrow:this.getArrow(p-30,s-9,">>>")};for(var c in this.focusDarkMap){var u=this.focusDarkMap[c];getEl(document.body).add(u),window.getComputedStyle(u).background,"arrow"!=c&&this.setBackgroundColor(u,"rgba(0,0,0,.7)")}return!0}},PopMan.prototype.focusOff=function(){for(var t in this.focusDarkMap){var e=this.focusDarkMap[t];getEl(e.parentNode).del(e),delete this.focusDarkMap[t]}},PopMan.prototype.getDivCamSizeChecker=function(){if(!this.divCamSizeChecker){var t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.left="-7777px",t.style.top="-7777px",document.body.appendChild(t),this.divCamSizeChecker=t}return this.divCamSizeChecker},PopMan.prototype.spreadDark=function(t){var e=this,o=getData().findHighestZIndex(["div"])+1,n="rgba(0,0,0,.7)",i=document.createElement("div");this.darkElementList.push(i),t.closebyclickout&&(getEl(i).addEventListener("mousedown",function(o){o.preventDefault(),o.stopPropagation(),e.meta.nowClickControlPop=t}),getEl(i).addEventListener("mouseup",function(o){o.preventDefault(),o.stopPropagation(),e.meta.nowClickControlPop===t&&(e.meta.nowClickControlPop=null,e.close(t.element))})),i.style.display="block",i.style.position="fixed",i.style.left="0px",i.style.top="0px",getEl(document.body).add(i),getEl(i).clas.add("sj-popman-obj-dark"),i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.zIndex=o;try{i.style.background=n}catch(p){if(n.indexOf("rgba")!=-1){n=n.replace("rgba","rgb");var s=n.lastIndexOf(",");n=n.substring(0,s)+")"}i.style.background=n}return i},PopMan.prototype.adjustPossition=function(t,e){var o=this.getPop(t),n=o.popContainerElement,i=n.parentNode.offsetWidth,p=n.parentNode.offsetHeight;p=0==p?this.getDivCamSizeChecker().offsetHeight:p,getEl(n).addStyle("position","fixed").addClass("sj-popman-obj-container"),getEl(n).hasSomeClass(["sj-popman-obj-context-alert","sj-popman-obj-context-confirm","sj-popman-obj-context-loading"])||getEl(n).addClass("sj-popman-obj-context-pop");var s;o.exp?(s=this.getSolved2DPopExpMap(o.exp,i,p),n.style.left=this.nvlDan(s.posX,"px"),n.style.top=this.nvlDan(s.posY,"px"),n.style.width=this.nvlDan(s.sizeX,"px"),n.style.height=this.nvlDan(s.sizeY,"px")):(s=this.getSolvedPopExpMap(o.expx,i),n.style.left=this.nvlDan(s.pos,"px"),n.style.width=this.nvlDan(s.size,"px"),s=this.getSolvedPopExpMap(o.expy,p),n.style.top=this.nvlDan(s.pos,"px"),n.style.height=this.nvlDan(s.size,"px"))},PopMan.prototype.nvlDan=function(t,e){var o=(t+"").length,n=(parseFloat(t)+"").length;return n==o?result=t+e:result=t,result},PopMan.prototype.getSolvedPopExpMap=function(t,e){var o,n,i,p,s,r,a,l,d,c=this.getSize;if(t){var u=t.indexOf("("),f=t.indexOf(")");d=u!=-1&&f!=-1,d?(n=t.substring(0,u),p=t.substring(f+1,t.length),i=t.substring(u+1,f)):(n="*",i=t,p="*"),s=c(e,n),r=c(e,i),a=c(e,p),"*"==i&&(r=e-s-a),l="*"==n&&"*"!=p?e-r-a:"*"!=n&&"*"==p?0:"*"==n&&"*"==p?(e-r)/2:s,o={isPopExp:d,expStart:n,expEnd:p,expSize:i,pos:l,size:r}}else o={isPopExp:!1,expStart:n,expEnd:p,expSize:i,pos:e-e/2-e/4,size:e/2};return o},PopMan.prototype.getSolved2DPopExpMap=function(t,e,o){var n,i,p=t.split("/");if(1==p.length){var s=p[0].trim();n=this.getSolvedPopExpMap(s,e),i=this.getSolvedPopExpMap(s,o)}else n=this.getSolvedPopExpMap(p[0].trim(),e),i=this.getSolvedPopExpMap(p[1].trim(),o);return{posX:n.pos,sizeX:n.size,posY:i.pos,sizeY:i.size}},PopMan.prototype.getSize=function(t,e){return"undefined"==typeof e?0:(e+"").indexOf("%")!=-1?t*(parseFloat(e)/100):(e+"").indexOf("*")!=-1?0:e},PopMan.prototype.closeDark=function(t){for(var e=this.darkElementList,o=0;o<e.length;o++)e[o]==t&&(e.splice(o,1),getEl(t.parentNode).del(t))},PopMan.prototype.pushStack=function(t){this.popElementStackList.push(t),1==this.popElementStackList.length&&this.execEventListenerByEventName("beforefirstpop")},PopMan.prototype.removeStack=function(t){for(var e=this.popElementStackList,o=e.length-1;o>-1;o--)e[o]==t&&e.splice(o,1);0==this.countStack()&&this.execEventListenerByEventName("afterlastpop")},PopMan.prototype.countStack=function(){return this.popElementStackList.length},PopMan.prototype.getDarkElement=function(t,e,o,n){function i(t){return t>=0?t:0}var p=50,s=document.createElement("div"),r="px";return s.style.left=t+r,s.style.top=e+r,s.style.width=i(o-t)+r,s.style.height=i(n-e)+r,s.style.zIndex=p,s.style.display="block",s.style.position="fixed",s.style.transition="background-color .5s, transform .5s",this.setBackgroundColor(s,"rgba(255,255,255,0)"),s},PopMan.prototype.getArrow=function(t,e,o){var n=51,i=document.createElement("div"),p="px";return i.style.left=t+p,i.style.top=e+p,i.style.width="30px",i.style.height="30px",i.style.zIndex=n,i.style.display="block",i.style.position="absolute",i.style.transition="background-color .5s, transform .5s",i.style.color="white",i.innerHTML=o,i},PopMan.prototype.getBodyOffset=function(t){for(var e=0,o=0,n=t,i=t.parentNode;i;){var p=0,s=0;if(n!=document.body&&(p=n.scrollLeft,s=n.scrollTop),!i.style)break;if("absolute"==i.style.position)e+=n.offsetLeft-p,o+=n.offsetTop-s;else{if("fixed"==i.style.position||"fixed"==n.style.position){e+=n.offsetLeft+this.getBodyScrollX(),o+=n.offsetTop+this.getBodyScrollY();break}e+=n.offsetLeft-i.offsetLeft-p,o+=n.offsetTop-i.offsetTop-s}n=i,i=i.parentNode}var r={left:e,top:o,width:t.offsetWidth,height:t.offsetHeight};return r},PopMan.prototype.getFrameOffset=function(t,e){if(e="undefined"==typeof e?{top:0,left:0}:e,t!==top){var o=t.frameElement.getBoundingClientRect();e.left+=o.left,e.top+=o.top,e=this.getFrameOffset(t.parent,e)}return e},PopMan.prototype.setBackgroundColor=function(t,e){try{t.style.background=e}catch(o){if(e.indexOf("rgba")!=-1){e=e.replace("rgba","rgb");var n=e.lastIndexOf(",");e=e.substring(0,n)+")"}t.style.background=e}};